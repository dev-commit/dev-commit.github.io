<h2>Custom Elements</h2>

<u-message-error>document.registerElement => window.customElements.define (устаревшая конструкция)</u-message-error>

<ul class="list-point">
	<li>Стандарт Custom Elements позволяет описывать для новых элементов свои свойства, методы, объявлять свой DOM, подобие конструктора и многое другое</li>
</ul>
<ul class="list-point">
	<li>Использовать новый элемент в HTML можно и до его объявления через <u>registerElement</u></li>
	<li>Для этого в браузере предусмотрен специальный режим «обновления» существующих элементов</li>
	<li>Если браузер видит элемент с неизвестным именем, в котором есть дефис - (такие элементы называются <u>«unresolved»</u>), то</li>
	<ul class="list-point">
		<li>Он ставит такому элементу специальный CSS-псевдокласс <u>:unresolved</u>, для того, чтобы через CSS можно было показать, что он ещё «не подгрузился»</li>
		<li>При вызове <u>registerElement</u> такие элементы автоматически обновятся до нужного класса</li>
	</ul>
</ul>

<pre><code class="js light">
<table>
	<tr><td><bg-methods>document.registerElement</bg-methods><bg-arguments>(имя, {prototype:прототип})</bg-arguments></td><td>  //</td></tr>
	<tr><td><em>	&#8226; имя</em></td><td>  // имя нового тега, например "mega-select". Оно обязано содержать дефис "-". Спецификация требует дефис, чтобы избежать в будущем конфликтов со стандартными элементами HTML. Нельзя создать элемент timer или myTimer – будет ошибка</td></tr>
	<tr><td><em>	&#8226; прототип</em></td><td>  // объект-прототип для нового элемента, он должен наследовать от HTMLElement, чтобы у элемента были стандартные свойства и методы</td></tr>
</table></code></pre>

<!------------------------------------------------------>
<h3>Регистрация элемента</h3>
<!------------------------------------------------------>
<div class="container-flex"><div class="container-half"><pre><code class="js">
var element = <u-code>Object.create(HTMLElement.prototype)</u-code>;
element.action = function(content) {
    this.innerHTML = content;
};
<u-code>document.registerElement</u-code>("my-element", {
    prototype: element
});
document.querySelector('my-element').action('zzz');
<br><br>
</code></pre></div><div class="container-half"><pre><code class="js">
<u-code>document.registerElement</u-code>("my-element", {
    prototype: {
        __proto__: <u-code>HTMLElement.prototype</u-code>,
        action: function(content) { 
        	this.innerHTML = content; 
        },
        value: 77
    }
});
document.querySelector('my-element').action('zzz');
var a = document.querySelector('my-element').value;
</code></pre></div></div>

<pre><code class="html">
&lt;my-element&gt;Hello&lt;/my-element&gt;
</code></pre>

<!------------------------------------------------------>
<h3>Расширение встроенных элементов</h3>
<!------------------------------------------------------>
<pre><code class="js">
var element = <u-code>Object.create(HTMLButtonElement.prototype)</u-code>;
element.action = function(content) {
    this.innerHTML = content;
};
<u-code>document.registerElement</u-code>("my-element", {
    prototype: element,
    <u-code>extends: 'button'</u-code>
});
document.querySelector('button').action('zzz');
</code></pre>
<pre><code class="css">
&lt;button <u-code>is="my-element"</u-code>&gt;&lt;/button&gt;
</code></pre>

<!------------------------------------------------------>
<h3>Жизненный цикл</h3>
<!------------------------------------------------------>
<pre><code class="bash">
<em>createdCallback</em>                                     # элемент создан
<em>attachedCallback</em>                                    # элемент добавлен в документ
<em>detachedCallback</em>                                    # элемент удалён из документа
<em>attributeChangedCallback(name, prevValue, newValue)</em> # атрибут добавлен, изменён или удалён
</code></pre>

<pre><code class="js">
element.createdCallback = function() {
    //
}
</code></pre>

<!------------------------------------------------------>
<h3>Примеры</h3>
<!------------------------------------------------------>

<!--__________________________________________________-->
<h4>#1 - Элемент таймер</h4>
<pre><code class="js">
// прототип с методами для нового элемента
var MyTimerProto = <u-code>Object.create(HTMLElement.prototype)</u-code>;
MyTimerProto.tick = function() { // свой метод tick
    this.innerHTML++;
};

// регистрируем новый элемент в браузере
<u-code>document.registerElement</u-code>("my-timer", {
    prototype: MyTimerProto
});

// вызовем метод tick() на элементе
setInterval(function() {
    timer.tick();
}, 1000);
</code></pre>
<pre><code class="html">
&lt;my-timer id="timer"&gt;0&lt;/my-timer&gt;
</code></pre>

<!--__________________________________________________-->
<h4>#2 - Элемент hello-world с таймером</h4>
<pre><code class="js">
// регистрация произойдёт через 2 сек
setTimeout(function() {
    <u-code>document.registerElement</u-code>("hello-world", {
        prototype: {
            __proto__: HTMLElement.prototype,
            sayHi: function() { alert('Привет!'); }
        }
    });
    hello.sayHi();
}, 2000);
</code></pre>
<pre><code class="css">
/* стиль для :unresolved элемента (до регистрации) */
hello-world<u-code>:unresolved</u-code> {
    color: blue;
}
hello-world {
    transition: color 3s;
}
</code></pre>
<pre><code class="html">
&lt;hello-world id="hello"&gt;Hello, world!&lt;/hello-world&gt;
</code></pre>
