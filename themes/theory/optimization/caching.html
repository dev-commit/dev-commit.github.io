<h2>Кэширование</h2>

<ul class="list-point">
    <li><u-text-define>Кэширование (кэш)</u-text-define> - это некий промежуточный буфер, в котором хранятся данные. Благодаря кэшированию страница сайта не воссоздается заново для каждого пользователя. Кэширование позволяет осуществлять работу с большим количеством данных в максимально сжатые сроки и при ограниченных ресурсах (серверных и пользовательских).</li>
</ul>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>1. Браузерное кэширование (клиентское кэширование)</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->

<ul class="list-point">
    <li>Представляет собой составление для браузера команды использовать имеющуюся кэшированную копию. Работа такого кэширования основана на том, что при повторном посещении, браузеру отдаётся заголовок 304 Not Modified, а сама страница или картинка загружаются из локального пользовательского кэша. Получается, что вы экономите на трафике между браузером посетителя и хостингом сайта. Соответственно, страница вашего сайта начинает загружаться быстрее.</li>
</ul>

<!------------------------------------------------------------->
<h4>1.1 Кэширование файлов и картинок</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Картинка не скачивается каждый раз при открытии сайта, а просто загружается через кэш браузера.</li>
    <li>Это первый уровень кэширования, который состоит в отдаче заголовка «expired» и заголовка «304 Not Modified». Наиболее эффективным считается кэширование на 2 недели.</li>
    <li>Но если изображение на сайте меняется, то браузер узнает об этом не сразу, а только если выждать expiry или сбросить кэш в самом браузере. Это не очень эффективно, если файл постоянно изменяется и необходимо постоянно отдавать его актуальную версию.</li>
</ul>

<!------------------------------------------------------------->
<h4>1.2 Кэширование HTTPS</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Специальные заголовки вида <u>strict-security</u>.</li>
    <li>Позволяет браузеру всегда обращаться по https к выбранному домену. Сохраняет это состояние довольно жёстко и, в случае отмены этого вида кэша, браузер ещё довольно долго будет пытаться загрузить страницу по https, при этом игнорируя текущие заголовки.</li>
</ul>

<!------------------------------------------------------------->
<h4>1.3 Кэширование центра сертификации (stamp центра сертификации)</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Данный вид кэширования считается обязательным для применения, если вы не хотите, чтобы пользователи вашего сайта ждали, когда центр сертификации (а это некий сервер, который отвечает за достоверность вашего сертификата) обработает запрос от браузера пользователя и подтвердит, что ваш сайт действительно подтверждён им.</li>
</ul>

<!------------------------------------------------------------->
<h4>1.4 Кэширование страниц</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Когда страница уже сгенерирована, нужно постоянно отслеживать ее актуальность. Для этого вы должны использовать серверный кэш с отслеживанием времени изменения отдельных частей страницы (если страница строится из множества динамически генерируемых блоков). При таком подходе в каждом ответе от сервера установлены специальные заголовки, обозначающие время изменения страницы, которые затем отправляются браузером пользователя при повторном обращении к странице сайта. Сервер при получении таких заголовков может проанализировать текущее состояние страницы (возможно, даже отрисовать её), но вместо содержимого страницы отдать заголовок «304 Not Modified», что для пользовательского браузера будет означать, что можно показать страницу из своего (браузера пользователя) кэша.</li>
    <li>Конечно, можно отправлять соответствующие заголовки без использования серверного отслеживания кэша, но в таком случае большинство пользователей получат обновление контента страницы довольно поздно. При таком подходе браузер иногда опрашивает сервер для получения обновлений, но периодичность и правила для каждого браузера настраиваются его разработчиком, поэтому надеяться на то, что ваши пользователи получат обновления вовремя, не приходится.</li>
    <li></li>
</ul>

<hr>

<ul class="list-point">
    <b>Как правило, кэш подразделяется по типу пользователей:</b>
    <li>Для авторизованных;</li>
    <li>Для неавторизованных</li>
</ul>

<hr>

<ul class="list-point">
    <li>Данное разделение обусловлено уникальностью контента, для каждого авторизованного пользователя и общностью контента для гостевых пользователей. В большинстве сайтов не авторизованный пользователь не может изменять содержимое сайта, а значит и влиять на его содержимое.</li>
    <li>Браузерный кэш позволяет экономить трафик и время, затрачиваемое на загрузку страниц. Но для достижения эффекта экономии, пользователь должен хотя бы один раз посетить нашу страницу, а это означает, что нагрузка на серверные ресурсы уменьшится, но не значительно.</li>
</ul>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>2. Серверное кэширование</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ul class="list-point">
    <li>Под серверным кэшированием понимаются все виды кэширования, при котором данные хранятся на серверной стороне. Эти данные не доступны клиентским браузерам.</li>
    <li>Кэш создаётся и хранится по принципу «один ко многим» (многие, в данном случае, — это клиентские устройства).</li>
</ul>

<!------------------------------------------------------------->
<h4>2.1 Кэширование страницы целиком</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Наиболее эффективный кэш.</li>
    <li>Отдача страницы происходит практически в момент обращения, как следствие – это возможность обработки миллионов запросов даже на самом слабом сервере со скоростью работы памяти и с незначительным задействованием процессора.</li>
    <li><u>Минусы:</u> невозможность кэшировать страницы для авторизованного пользователя, либо пользователя, содержимое страницы которого зависит от текущих переменных пользователя.</li>
    <li>Используйте этот кэш, если серверу известны все статичные состояния внешних данных, такие как: uri, get (без дополнительных параметров), пользователь не авторизован — т.е., фактически, это идеальное состояние страницы для гостевых пользователей. Учитывайте тот факт, что при таком кэшировании архитектура сайта или приложения всегда должна однотипно обрабатывать входящие запросы и отдавать однотипные ответы. Такое состояние есть в любом приложении или сайте, его нужно лишь отследить и применить к нему кэш.</li>
    <li>Кэширование страниц целиком, чаще всего, применяют в каких-то экстренных случаях, при этом кэш страниц сохраняется на заранее указанное время (от 2 минут), в течение которого ответы от сервера однотипны (не позволяйте браузеру кэшировать это).</li>
</ul>

<!------------------------------------------------------------->
<h4>2.2 Кэширование результатов компиляции PHP-файлов</h4>
<!------------------------------------------------------------->
<i>Различают как чистую компиляцию кода, так и его оптимизацию во время компилирования (подмена скриптов):</i>

<ul class="list-point">
    <li>APC</li>
    <li>XCache</li>
    <li>Компиляция с подменой скриптов HipHopVirtualMachine</li>
</ul>

<!------------------------------------------------------------->
<h4>2.3 Кэширование отдельных блоков страницы</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Сложный вид кэширования</li>
    <li><u>Необходимо отслеживать</u>: состояние таблиц, состояние сессии пользователя, выключать ли кэширование при POST или GET запросах (http query), зависимость от текущего адреса, постоянство кэширования (при изменении предыдущих условий) или его динамическую подстройку.</li>
    <li><u>Применение</u>: если нужно, уменьшить количество запросов к базе данных от реальных (авторизованных) пользователей</li>
</ul>

<!------------------------------------------------------------->
<h4>2.4 Кэширование php на основе неразделяемых ресурсов</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Лучше всего подходит при стандартизации запросов, получении данных из общих ресурсов, наличии внутренних переменных, к которым php-ресурсы обращаются несколько раз при генерации страницы.</li>
</ul>

<!------------------------------------------------------------->
<h4>2.5 Кэширование php на основе общих ресурсов</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Применяется для хранения сериализированных данных: конфигурационного файла, состояния таблиц, списков файловой системы.</li>
</ul>

<!------------------------------------------------------------->
<h4>2.6 Кэширование mysql на основе query cache</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Кэшировать эти запросы имеет смысл, если чтений из таблицы немного больше чем записи.</li>
</ul>

<!------------------------------------------------------------->
<h4>2.7 Кэширование mysql результатов работы, агрегирующие таблицы</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Существует правило: обновлений данных должно быть значительно меньше, чем чтения для их отдачи. Т.е. не имеет смысл агрегировать то, что изменится в тот же момент, при этом важна актуальность агрегированных данных.</li>
</ul>

