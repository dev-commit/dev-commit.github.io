<h2>Конструктор new</h2>

<ul class="list-point">
    <li><u-code-text>new</u-code-text> недоступно у стрелочной функции</li>
</ul>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Полифил</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-code lang="js" title="">
function Person(name) {
	this.name = name;
}
function Foo(Constructor, ...props) {
	// 1. Создаётся новый пустой объект через Object.create
	// Устанавливает __proto__ этому объекту в которое записывается ссылка из <u>prototype</u>
	const instance = Object.create(Constructor.prototype);

	// 2. Модифицируется <u>this</u> (т.е. этот новый объект) и инициализируются методы и свойства
	// Применяет функцию-класс к нашему новосозданному объекту
	const result = Constructor.apply(instance, props);

	// 3. Неявно возвращается <u>this</u> без вызова <u>return</u>
	// Если в return объект, то вернется он
	// return (typeof instance === 'object' && instance !== null) ? instance : {};
	return instance instanceof Object ? instance : {};
}

const foo = Foo(Person, 'Tony');
console.log(foo);
</v-code>



<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Функция-конструктор</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-code lang="js" title="">
function User(name) {
	this.name = name;
	this.isAdmin = false;
}

let user = new User("Вася");

alert(user.name); // Вася
alert(user.isAdmin); // false
</v-code>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Вызов функции через new User(...)</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ol class="list-num">
	<li>Создаётся новый пустой объект, и он присваивается <u-code-text>this</u-code-text></li>
	<li>Выполняется код функции. Обычно он модифицирует <u-code-text>this</u-code-text>, добавляет туда новые свойства</li>
	<li>Возвращается значение <u-code-text>this</u-code-text></li>
</ol>

<v-code lang="js" title="">
function User(name) {
	// this = {};  (неявно)

	// добавляет свойства к this
	this.name = name;
	this.isAdmin = false;

	// return this;  (неявно)
}
</v-code>

<v-code lang="js" title="">
// То есть, результат вызова new User("Вася") – это тот же объект, что и:
let user = {
	name: "Вася",
	isAdmin: false
};
</v-code>
