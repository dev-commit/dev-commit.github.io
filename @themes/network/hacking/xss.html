<!-- TODO:
<f-search>Network -> Hacking -> XSS</f-search>
-->

<h2>XSS</h2>

<ul class="list-point">
    <li><u-text-define>XSS</u-text-define> (Cross-Site Scripting / Межсайтовый скриптинг) - вид атаки, при которой в страницу сайта внедряется вредоносный код</li>
    <li>При открытии страницы пользователем, код выполняется на его компьютере и устанавливает соединение с веб-сервером злоумышленника, который таким образом получает контроль над системой</li>
    <li>Основная цель злоумышленника - запустить вредоносный скрипт на компьютере жертвы</li>
</ul>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>На что нацелен</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ul class="list-point">
	<li>Кража конфиденциальных данных, переадресацию пользователя на подконтрольные хакерам сайты или на манипуляцию компьютера в интересах злоумышленников</li>
    <li>Кража cookies пользователей при помощи встроенного на сервере скрипта с дальнейшей выборкой необходимых данных и использованием их для последующих атак и взломов</li>
</ul>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Общая классификация XSS</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->

<!------------------------------------------------------------->
<h4>1. Хранимые XSS (постоянные)</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Один из самых опасных типов уязвимостей, так как позволяет злоумышленнику получить доступ к серверу и уже с него управлять вредоносным кодом (удалять, модифицировать)</li>
    <li>Каждый раз при обращении к сайту выполняется заранее загруженный код, работающий в автоматическом режиме. В основном таким уязвимостям подвержены форумы, порталы, блоги, где присутствует возможность комментирования в HTML без ограничений. Вредоносные скрипты с легкостью могут быть встроены как в текст, так и в картинки, рисунки.</li>
</ul>

<!------------------------------------------------------------->
<h4>2. Отраженные XSS (непостоянные)</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>В этом случае вредоносная строчка выступает в роли запроса жертвы к зараженному веб-сайту</li>
</ul>

<ol class="list-num">
    <b>Схема работы</b>
    <li>Злоумышленник заранее создает URL-ссылку, которая будет содержать вредоносный код и отправляет его своей жертве</li>
    <li>Она направляет этот URL-запрос на сайт (переходит по ссылке)</li>
    <li>Сайт автоматически берет данные из вредоносной строки и подставляет в виде модифицированного URL-ответа жертве</li>
    <li>В итоге в браузере у жертвы выполняется вредоносный скрипт, который и содержится в ответе, а злоумышленник получает все cookies этого пользователя</li>
</ol>

<!------------------------------------------------------------->
<h4>3. DOM-модели</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>В этом варианте возможно использование как хранимых XSS, так и отраженных</li>
</ul>

<ol class="list-num">
    <b>Схема работы</b>
    <li>Злоумышленник создает URL-адрес, который заранее содержит вредоносный код, и отправляет его по электронной почте или любым другим способом пользователю</li>
    <li>Человек переходит по этой ссылке, зараженный сайт принимает запрос, исключая вредоносную строку</li>
    <li>На странице у пользователя выполняется сценарий, в результате чего загружается вредоносный скрипт и злоумышленник получает cookies</li>
</ol>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Виды XSS по способу взаимодействия</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->

<!------------------------------------------------------------->
<h4>1. Пассивные</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Код встраивается в определенную страницу, на которую пользователь привлекается, к примеру, с помощью фишинга</li>
    <li>Суть: заставить пользователя перейти по вредоносной ссылке для выполнения «вредокода»</li>
</ul>

<ul class="list-point">
    <li><u-text-define>Фишинг</u-text-define> - форма киберпреступности, основанная на методах социальной инженерии. Предполагает кражу конфиденциальных данных с компьютера пользователя и использование этих данных для получения его денег. Мошенник создает, например, копию сайта финансового учреждения или онлайн-магазина и пытается заманить туда пользователя, чтобы заставить его ввести свои имя, пароль, номер кредитной карточки и т.д.</li>
</ul>

<!------------------------------------------------------------->
<h4>2. Активные</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Код внедряется на уровне базы данных или исполняемом файле на сервере</li>
    <li>От пользователя не требуется никакой активности. У форм ввода, как правило, установлен специальный обработчик событий, автоматически активирующийся при попадании на эту страничку</li>
    <li>В итоге все пользователи, перешедшие по этой ссылке, станут жертвами злоумышленника</li>
    <li>Хакер пытается найти уязвимость в фильтре сайта: при помощи комбинации тегов и символов создается такой запрос, чтобы сайт его понял и выполнил команду</li>
</ul>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Методика атаки через XSS</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ul class="list-point">
    <li>Запуск вредоносного кода JavaScript возможен только в браузере жертвы, поэтому сайт, на который зайдет пользователь, должен иметь уязвимость к XSS</li>
</ul>

<!------------------------------------------------------------->
<h4>Вариант 1</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>1. Для совершения атаки злоумышленник изначально проверяет ресурсы на наличие уязвимостей через XSS, используя автоматизированные скрипты или ручной режим поиска. Обычно это стандартные формы, которые могут отправлять и принимать запросы (комментарии, поиск, обратная связь)</li>
    <li>2. Проводится полный сбор страниц с формами ввода, и каждая сканируется на наличие уязвимостей. Например, у нас есть страница «Поиск» на сайте. Для проверки уязвимости XSS достаточно ввести запрос: <u-code-text>&lt;script&gt;alert("cookie: "+document.cookie)&lt;/script&gt;</u-code-text></li>
    <li>Если на экране появится уведомление, значит вы обнаружили брешь в безопасности. В противном случае система отобразит вам страницу с результатами поиска</li>
</ul>

<!------------------------------------------------------------->
<h4>Вариант 2: использование страниц, которые обрабатывают GET-запросы</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Допустим, у нас есть ссылка вида: <u-code-text>http://site.ru/catalog?p=8</u-code-text></li>
    <li>В адресной строке вместо идентификатора <u-code-text>(8)</u-code-text> добавляем скрипт – <u-code-text>"&gt;&lt;script&gt;alert("cookie: "+document.cookie)&lt;/script&gt;</u-code-text>, в результате чего получаем ссылку такого вида: <u-code-text>http://site.ru/catalog?p= "&gt;&lt;script&gt;alert("cookie: "+document.cookie)&lt;/script&gt;</u-code-text></li>
    <li>Если страница имеет уязвимости XSS, на экране появится уведомление такого же плана, как и в первом случае</li>
</ul>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Предотвращение</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<u-link-wrapper>
    <v-link url="http://xss-scanner.com/" text="" list="true" />
</u-link-wrapper>

<ol class="list-num">
	<li>Фильтрация получаемых данных</li>
    <li>В обязательном порядке нужно проверять все URL, где возможна отправка данных со стороны пользователя (формы комментариев, обратная связь, поиск)</li>
    <li>Исключить все опасные спецсимволы, заменив их безопасными. Речь идет о скобках < и >, в которых и прописываются все зарезервированные языком html-запросы и теги</li>
</ol>
