<h2>Virtual DOM (React)</h2>

<ul class="list-point">
    <li>React создает легковесное дерево из JavaScript-объектов для имитации DOM-дерева. Затем он создает из них HTML, который вставляется или добавляется к нужному DOM-элементу, что вызывает перерисовку страницы в браузере</li>
    <li>JS объекты просто строить и сравнивать</li>
</ul>

<!------------------------------------------------------------->
<h4>Алгоритм</h4>
<!------------------------------------------------------------->
<ol class="list-num">
	<li>Происходит рендер React приложения</li>
	<li>Дерево элементов, которое описывает приложение, генерируется в зарезервированной памяти</li>
	<li>Это дерево потом включается в рендеринг окружение - на примере браузерного приложения, оно переводится в набор DOM операций</li>
	<li>Когда состояние приложения обновляется (обычно вызовом setState), новое дерево генерируется</li>
	<li>Новое дерево сравнивается с предыдущим, чтоб просчитать и включить именно те операции, которые нужны для перерисовки обновленного приложения</li>
</ol>

<!------------------------------------------------------------->
<h4>1. Первоначальный Render DOM</h4>
<!------------------------------------------------------------->
<ol class="list-num">
<li>Вернули JSX</li>
<v-code lang="js" title="">
class App extends React.Component {
	render(
		return (
			&lt;div&gt;Hello&lt;/div&gt;
		)
	);
}
</v-code>

<li>Транспиляция в React.createElement (Virtual DOM)</li>
<v-code lang="js" title="">
React.createElement('div', null, 'Hello'),
</v-code>

<li>Рендер в браузер DOM (react-dom)</li>
<v-code lang="js" title="">
ReactDOM.render(&lt;App /&gt;, document.getElementById('root'));
</v-code>
</ol>

<!------------------------------------------------------------->
<h4>2. Изменение setState()</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>При нажатии setState() каждый раз асинхронно (React 16) перестраивается Virtual DOM для компонента и всех его потомков. Но в DOM идут только изменения</li>
</ul>
<ol class="list-num">
	<li>Произошел <u-code-text>setState()</u-code-text> в компоненте <u-code-text>App</u-code-text>. Помечаем компонент как "грязный"</li>
	<li>Перестроение Virtual DOM</li>
	<li>Сравнение измененного Virtual DOM и старого Virtual DOM. При нахождении изменений, меняется компонент в реальном DOM</li>
</ol>

<img src="/@img/react/reconciler/virtual-dom-set-state.png" width="450px">
