<h2>üëø Retrier</h2>

<ul class="list-point">
    <li>–ï—Å—Ç—å Retrier, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –ø–æ URL</li>
    <li>–í —Å–ª—É—á–∞–µ—Ç –Ω–µ—É–¥–∞—á–∏, –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª-–≤–æ —Ä–∞–∑</li>
    <li>–ï—Å–ª–∏ –Ω–µ –±—ã–ª–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ—Å–ª–µ –ø–æ–ø—ã—Ç–æ–∫, –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ</li>
</ul>

<!------------------------------------------------------------->
<h4>#1</h4>
<!------------------------------------------------------------->
<v-code lang="js" title="">
function retrier(url, n) {
	if (n > 0) {
		return fetch(url)
			.then(data => {
				if (data.statusCode >= 200 && data.statusCode < 300) {
					return data;
				} else {
					return retrier(url, n-1);
				}
			})
			.catch(err => {
				return retrier(url, n-1);
			})
	} else {
		throw Error('Error');
	}
}
</v-code>

<!------------------------------------------------------------->
<h4>#2</h4>
<!------------------------------------------------------------->
<v-code lang="js" title="">
function retrier(url: string, times: number) {
    let count = 0;

    if (count === number) {
        return;
    }

    return new Promise(function(resolve, reject) {
        function request(url) {
            fetch(url).then(data, error => {
                if (data) {
                    resolve(data);
                }
                if (error) {
                    count++;
                    request(url);
                    reject(error);
                }
            })
        }
    })

    for (let i = 0; i < times; i++) {
        request(url);
    }
}
</v-code>

<!------------------------------------------------------------->
<h4>#3</h4>
<!------------------------------------------------------------->
<!-- –ì—Ä–∏—à–∞–Ω–æ–≤–∏—á -->

<v-code lang="js" title="">
retrier(url, retryCount): Promise

function retrier(url, retryCount) {
    let count = 1;
    return new Promise((resolve, reject) => {
        send(url);
        function send(url) {
        fetch(url)
       .then(response = > resolve(response))
       .catch(err => {
           if(count <= retryCount){
            count++
            send(url);
           } else {
               reject(err)
           }
       })
    }
    });
}
</v-code>

<!------------------------------------------------------------->
<h4>#4</h4>
<!------------------------------------------------------------->
<!-- –ö–∞—Ä–∞ -->

<v-code lang="js" title="">
const retrier = (url, retryCount) => fetch(url)
    .then(
        res => {
            if (res.ok) {
                return res;
            }
            if (retryCount) {
                return retrier(url, retryCount - 1);
            }
            throw res.error;
        },
        res => {
            if (retryCount) {
                return retrier(url, retryCount - 1);
            }
            throw res.error;
        }
    );

retrier('https://some.api', 5) // url
    .then(res) => console.log('–£—Å–ø–µ—à–Ω–æ');
    .catch(err) => console.log('–û—à–∏–±–∫–∞');
</v-code>

<!------------------------------------------------------------->
<h4>#5</h4>
<!------------------------------------------------------------->
<!-- –ú–∞—Ç–≤–µ–µ–≤ -->

<v-code lang="js" title="">
function retrier(url, retryCount): Promise {
    if (typeof retryCount === 'number' && retryCount > 0) {
        return fetch(url)
            .catch(err => {
                if (retryCount === 1) {
                    return Promise.reject(err);
                }
                return retrier(url, retryCount - 1);
            })
    } else {
        return Promise.reject('Failed');
    }
}

retrier('https://ya.ru', 123).then(data => ...);
</v-code>
