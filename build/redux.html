
    <!DOCTYPE html>
        <html>
        <head>
            <title>🪙 Redux</title>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <link rel="icon" type="image/png" href="../custom/favicon.svg">

            <script src="../src/js/utils.js"></script>
            <!-- Own JavaScript -->
            <script src="../@themes/redux/build-redux.js"></script>
        </head>
        <body>

            <div id="container">
                <div id="menu" :class="{ hide:isHideMenu }">
                    <div id="top">
                        <img
                            width="35px"
                            height="35px"
                            src="../src/img/show.svg"
                            class="img"
                            @click="toggleMenu()"
                        >
                        <a href="#links" class="top-link" v-html="'🪙 Redux'"></a>
                    </div>
                    <h4>🏷️ React Redux</h4><ul>
    <li>
        <a
            class="menu-link"
            id="id__redux/scheme/structure-common"
            href="#redux/scheme/structure-common"
        >
            🔥 Структура общая
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/scheme/structure-realization"
            href="#redux/scheme/structure-realization"
        >
            🔥 Структура реализации
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/code/redux"
            href="#redux/code/redux"
        >
            🧲 Redux
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/code/react-redux"
            href="#redux/code/react-redux"
        >
            🧲 React-Redux
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/main/redux-compare"
            href="#redux/main/redux-compare"
        >
            <u-menu-border>redux</u-menu-border> <u-menu-border>react-redux</u-menu-border> <u-menu-border>redux-toolkit</u-menu-border>
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/code/redux-toolkit"
            href="#redux/code/redux-toolkit"
        >
            Redux Toolkit
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/code/redux-saga"
            href="#redux/code/redux-saga"
        >
            Redux Saga
        </a>
    </li>
</ul><h4>🏷️ Элементы</h4><ul>
    <li>
        <a
            class="menu-link"
            id="id__redux/elements/execution-order"
            href="#redux/elements/execution-order"
        >
            📑 Порядок выполнения
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/elements/view"
            href="#redux/elements/view"
        >
            ⭐️ 1. View
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/elements/action"
            href="#redux/elements/action"
        >
            ⭐️ 2. Action
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/elements/middleware"
            href="#redux/elements/middleware"
        >
            ⭐️ 3. Middleware
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/elements/reducer"
            href="#redux/elements/reducer"
        >
            ⭐️ 4. Reducer
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/elements/store"
            href="#redux/elements/store"
        >
            ⭐️ 5. Store
        </a>
    </li>
</ul><h4>🏷️ Методы</h4><ul></ul><h4>🏷️ Redux</h4><ul>
    <li>
        <a
            class="menu-link"
            id="id__redux/methods/create-store"
            href="#redux/methods/create-store"
        >
            <u-menu>createStore</u-menu>
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/methods/apply-middleware"
            href="#redux/methods/apply-middleware"
        >
            <u-menu>applyMiddleware</u-menu>
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/methods/combine-reducers"
            href="#redux/methods/combine-reducers"
        >
            <u-menu>combineReducers</u-menu>
        </a>
    </li>
</ul><h4>🏷️ React-Redux</h4><ul>
    <li>
        <a
            class="menu-link"
            id="id__redux/methods/provider"
            href="#redux/methods/provider"
        >
            <u-menu-accent>Provider</u-menu-accent>
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/methods/connect"
            href="#redux/methods/connect"
        >
            <u-menu-accent>connect</u-menu-accent>
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/methods/hooks"
            href="#redux/methods/hooks"
        >
            <u-menu-accent>useDispatch</u-menu-accent> <u-menu-accent>useSelector</u-menu-accent>
        </a>
    </li>
</ul><h4>🏷️ Flux и Redux</h4><ul>
    <li>
        <a
            class="menu-link"
            id="id__redux/redux/info-flux"
            href="#redux/redux/info-flux"
        >
            📑 Flux
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/redux/info-redux"
            href="#redux/redux/info-redux"
        >
            📑 Redux
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/redux/functional-programming"
            href="#redux/redux/functional-programming"
        >
            📑 Принципы FP
        </a>
    </li>
</ul><h4>🏷️ Redux Plugins</h4><ul>
    <li>
        <a
            class="menu-link"
            id="id__redux/plugins/redux-toolkit"
            href="#redux/plugins/redux-toolkit"
        >
            <u-menu-border>@reduxjs/toolkit</u-menu-border>
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/plugins/redux-devtools-extension"
            href="#redux/plugins/redux-devtools-extension"
        >
            <u-menu-border>redux-devtools-extension</u-menu-border>
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/plugins/redux-thunk"
            href="#redux/plugins/redux-thunk"
        >
            <u-menu-border>redux-thunk</u-menu-border>
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/plugins/redux-saga"
            href="#redux/plugins/redux-saga"
        >
            <u-menu-border>redux-saga</u-menu-border>
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/plugins/redux-form"
            href="#redux/plugins/redux-form"
        >
            <u-menu-border>redux-form</u-menu-border>
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/plugins/redux-actions"
            href="#redux/plugins/redux-actions"
        >
            <u-menu-border>redux-actions</u-menu-border>
        </a>
    </li>

    <li>
        <a
            class="menu-link"
            id="id__redux/plugins/redux-logger"
            href="#redux/plugins/redux-logger"
        >
            <u-menu-border>redux-logger</u-menu-border>
        </a>
    </li>
</ul><h4>🏷️ Прочее</h4><ul>
    <li>
        <a
            class="menu-link"
            id="id__redux/other/constants-name"
            href="#redux/other/constants-name"
        >
            Название констант
        </a>
    </li>
</ul>
                </div>

                <div id="wrapper">
                    <div id="links">
                        <ul>
                            <slot v-for="itemLink in linksContent">
                                <li v-if="itemLink">
                                    <a
                                        :href="itemLink.page"
                                        :class="{
                                            ['theme-'+itemLink.theme]: true,
                                            active: itemLink.page == pageName
                                        }"
                                        v-html="itemLink.title"
                                    ></a>
                                </li>
                                <li v-else class="splitter"></li>
                            </slot>
                        </ul>
                    </div>
                    <div id="content"><div id="redux/scheme/structure-common"><h2>Общая структура</h2>

<u-link-wrapper>
    <a href="https://github.com/wix-incubator/react-dataflow-example/tree/master/src/store" target="_blank">Структура store</a>
</u-link-wrapper>

<ul class="list-point">
    <li>./src/store.js</li>
</ul>

<v-two-code type="bash;bash" comment="Одна директория;Отдельные директории">
<template v-slot:first>
├── <u-code-text>src</u-code-text>
│   ├── <u-code-text>store</u-code-text>
│   │   ├── <u-code-text>actions</u-code-text>
│   │   │   └── index.js
│   │   ├── <u-code-text>reducers</u-code-text>
│   │   │   └── index.js
│   │   │   └── reducer-starter.js
│   │   ├── <u-code-text>constants</u-code-text>
│   │   │   └── actionTypes.js
│   │   └── store.js
│   ├── index.js
</template>
<template v-slot:last>
├── <u-code-text>src</u-code-text>
│   ├── <u-code-text>actions</u-code-text>
│   │   └── index.js
│   ├── <u-code-text>reducers</u-code-text>
│   │   └── index.js
│   │   └── reducer-starter.js
│   ├── <u-code-text>constants</u-code-text>
│   │   └── actionTypes.js
│   ├── <u-code-text>stores</u-code-text>
│   │   └── store.js
│   ├── index.js
</template>
</v-two-code>

<img src="/@img/redux/react-redux-structure.png" width="750px">
</div><div id="redux/scheme/structure-realization"><h2>Структура реализации</h2>

<img src="/@img/redux/react-redux-dispatch.png" width="1000px">

<!------------------------------------------------------------->
<h4>1. View</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Нажали на кнопку</li>
    <li>Срабатывает <u-code-text>store.dispatch(setName('Tony'))</u-code-text></li>
    <li>Через <u-code-text>mapDispatchToProps()</u-code-text></li>
</ul>

<v-code lang="js" title="">
store.<u-code>dispatch</u-code>(setName('Tony'));
</v-code>

<!------------------------------------------------------------->
<h4>2. Action</h4>
<!------------------------------------------------------------->
<v-code lang="js" title="">
const setName = name => ({
	type: <u-code>'NAME'</u-code>,
	payload: name
});
</v-code>

<!------------------------------------------------------------->
<h4>3. Middleware</h4>
<!------------------------------------------------------------->
<v-code lang="js" title="">
const starterMiddleware = store => next => action => {
    // action           => { type: "NAME", payload: "Tony" }  - Action
    // state.getState() => { reducerStarter: { name: "" } }   - Prev State

    // Вызывается Reducer
    const newState = <u-code>next(action)</u-code>;
    
    // state.getState() => { reducerStarter: { name: "Tony" } }   - New State

    return newState;
}
</v-code>

<!------------------------------------------------------------->
<h4>4. Reducer</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Вызывается из Middleware при next(action)</li>
</ul>

<v-code lang="js" title=""> 
const reducerStarter = (state, action) => {
    switch (action.type) {
        case <u-code>'NAME'</u-code>:
        	return {
        		...state,
        		name: action.payload
        	}
        default: return state;
    }
};
</v-code>

<!------------------------------------------------------------->
<h4>5. View</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Срабатывает store.getState()</li>
    <li>Через mapStateToProps</li>
</ul>

<v-code lang="js" title="">
const AppRedux = ({ reduxStarterData }) => {
    //
}
const mapStateToProps = state => ({
	reduxStarterData: <u-code>state.reducerStarter</u-code>
})
const mapDispatchToProps = {
    setName
}
export default connect(
	mapStateToProps,
	mapDispatchToProps
)(AppRedux);
</v-code>
</div><div id="redux/code/redux"><h2>Redux</h2>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Методы</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-code lang="js" title="">
const store = <u-code>createStore</u-code>(reducerFunction); // создание store
store.<u-code>getState</u-code>();                           // получить состояние store
store.<u-code>subscribe</u-code>();                          // подписка на изменение store
store.<u-code>dispatch</u-code>({                            // событие обновления состояния store
    type: 'НазваниеСобытия', 
    payload: 'Данные' 
}); 
</v-code>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Пример использования</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-code lang="js border" title="">
// 1. STORE (создание store)
import { createStore } from 'redux';
const store = <u-code>createStore</u-code>(changeStore);

// 2. REDUCER
function changeStore(state = [], action) {
    switch (action.type) {
        case 'ADD_PRODUCT': {
            return [...state, action.payload];
        }
        default: {
            return state;
        }
    }
}

// 3. COMPONENT (подписка и получение состояния store)
store.<u-code>subscribe</u-code>(() => {
    console.log(store.<u-code>getState</u-code>());
});

// 4. COMPONENT (обновление состояния store)
store.<u-code>dispatch</u-code>({ type: 'ADD_PRODUCT', payload: 'Product1' });
store.<u-code>dispatch</u-code>({ type: 'ADD_PRODUCT', payload: 'Product2' });
</v-code>

<h5>Данные, которые вернет "action" в "changeStore"</h5>
<v-code lang="js none" title="">
{type: "@@redux/INITn.9.1.1.y.1"}          // всегда когда redux инициализирован
{type: "ADD_PRODUCT", payload: "Product1"} // добавленный action
</v-code>
</div><div id="redux/code/react-redux"><h2>React-Redux</h2>

<v-sandbox url="https://codesandbox.io/s/v8n57owly0" title="Пример из документации" />
<v-sandbox ok="true" url="https://codesandbox.io/s/redux-minimal-kfvp2s" title="Минимальный пример" />

<v-pre-npm>
npm i --save <u-code-accent>redux</u-code-accent>
npm i --save <u-code-accent>react-redux</u-code-accent>
npm i --save <u-code-accent>redux-devtools-extension</u-code-accent>
npm i --save <u-code-accent>redux-thunk</u-code-accent>
</v-pre-npm>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>1. PROVIDER</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-code lang="js border" title="index.js">
import React from 'react';
import ReactDOM from 'react-dom';

import { <u-code>Provider</u-code> } from 'react-redux';
import store from './redux/store';

import App from './App';

ReactDOM.render(
    &lt;<u-code>Provider store={store}</u-code>&gt;
        &lt;App /&gt;
    &lt;/<u-code>Provider</u-code>&gt;,
    document.getElementById('root')
);
</v-code>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>2. STORE</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-code lang="js border" title="redux/store.js">
import { <u-code>createStore</u-code>, applyMiddleware } from 'redux';
import { composeWithDevTools } from 'redux-devtools-extension';
import thunk from 'redux-thunk';
import rootReducer from './reducers';

export default <u-code>createStore</u-code>(
	rootReducer,
	composeWithDevTools(
		applyMiddleware(thunk)
	)
);
</v-code>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>3. REDUCERS</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-code lang="js border" title="redux/reducers/index.js">
import { <u-code>combineReducers</u-code> } from 'redux';
import reducerStarter from './reducer-starter';

export default <u-code>combineReducers</u-code>({
    reducerStarter
});
</v-code>

<v-code lang="js border" title="redux/reducers/reducer-starter.js">
import { NAME } from '../actionTypes';

const initialState = {
    name: ''
};

const reducerStarter = (state = initialState, action) => {
    switch (action.type) {
        case <u-code>NAME</u-code>:
            return {
                ...state,
                name: action.payload
            }
        default:
            return state;
    }
};

export default reducerStarter;
</v-code>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>4. ACTIONS (ACTIONS CREATOR)</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-code lang="js border" title="redux/actions.js">
import { NAME } from './actionTypes';

// возвращает объект
export const setName = (name) => ({
    type: <u-code>NAME</u-code>,
    payload: name
});

// возвращает функцию (redux-thunk)
export const setName = (name) => (dispatch) => {
	dispatch({
		type: <u-code>NAME</u-code>,
		payload: name
	})
};
</v-code>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>5. COMPONENT</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<i>App.js</i>
<v-two-code type="js border;js border" comment="Connect;Hooks">
<template v-slot:first>
import React from 'react';
import { <u-code>connect</u-code> } from 'react-redux';
import { setName } from '../../redux/actions';

const App = ({ name, setName }) =&gt; {
	return (
		&lt;&gt;
            &lt;h1&gt;{name}&lt;/h1&gt;
			&lt;button onClick={() =&gt; setName('Jack')}&gt;
				Name Jack
			&lt;/button&gt;
		&lt;/&gt;
	);
}

const mapStateToProps = state =&gt; ({
	<u-code>name</u-code>: state.reducerStarter.name
})
const mapDispatchToProps = {
	<u-code>setName</u-code>
}
export default connect(
	mapStateToProps,
	mapDispatchToProps
)(App);
</template>
<template v-slot:last>
import React from 'react';
import { <u-code>useDispatch</u-code>, <u-code>useSelector</u-code> } from 'react-redux';
import { setName } from '../../redux/actions';

const App = () =&gt; {
    const <u-code>dispatch</u-code> = useDispatch();
    const <u-code>name</u-code> = useSelector(state =&gt; state.reducerStarter.name);

	return (
		&lt;&gt;
            &lt;h1&gt;{name}&lt;/h1&gt;
			&lt;button onClick={() =&gt; dispatch(setName('Jack'))}&gt;
				Name Jack
			&lt;/button&gt;
		&lt;/&gt;
	);
}

export default App;
</template>
</v-two-code>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>6. ACTION TYPES</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-code lang="js border" title="redux/actionTypes.js">
export const NAME = 'NAME';
</v-code>
</div><div id="redux/main/redux-compare"><h2>Сравнение: redux, react-redux, redux-toolkit</h2>

<table>
    <tr>
        <th></th>
        <th>Website</th>
        <th>NPM</th>
        <th>CodeSandbox</th>
    </tr>
    <tr>
        <td class="accent" width="50px">Redux</td>
        <td><a href="https://redux.js.org/" target="_blank" class="link">https://redux.js.org/</a></td>
        <td class="code">
            npm i --save <u-code-accent>redux</u-code-accent>
        </td>
        <td width="200px">
            <v-sandbox ok="true" url="https://codesandbox.io/s/redux-basic-4s77yh" title="Redux (Basic)" />
            <br />
            <i>Директория "redux" аналогична "React-Redux (Basic)"</i>
        </td>
    </tr>
    <tr>
        <td class="accent">React Redux</td>
        <td><a href="https://react-redux.js.org/" target="_blank" class="link">https://react-redux.js.org/</a></td>
        <td class="code">
            npm i --save <u-code-accent>redux</u-code-accent> <u-code-accent>react-redux</u-code-accent>
        </td>
        <td>
            <v-sandbox ok="true" url="https://codesandbox.io/s/reactredux-basic-kfvp2s" title="React-Redux (Basic)" />
            <br />
            <i>Директория "redux" аналогична "Redux (Basic)"</i>
        </td>
    </tr>
    <tr>
        <td class="accent">Redux Toolkit</td>
        <td><a href="https://redux-toolkit.js.org/" target="_blank" class="link">https://redux-toolkit.js.org/</a></td>
        <td class="code">
            npm i --save <u-code-accent>react-redux</u-code-accent> <u-code-accent>@reduxjs/toolkit</u-code-accent>
        </td>
        <td>
            <v-sandbox ok="true" url="https://codesandbox.io/s/reduxtoolkit-basic-fz4tym" title="Redux-Toolkit (Basic)" />
        </td>
    </tr>
    <tr>
        <td class="accent">Redux Saga</td>
        <td><a href="https://redux-saga.js.org/" target="_blank" class="link">https://redux-saga.js.org/</a></td>
        <td class="code">
            npm i --save <u-code-accent>react-redux</u-code-accent> <u-code-accent>@reduxjs/toolkit</u-code-accent> <u-code-accent>redux-saga</u-code-accent>
        </td>
        <td>
            <v-sandbox ok="true" url="https://codesandbox.io/s/redux-saga-basic-z688sq" title="Redux-Saga (Basic)" />
        </td>
    </tr>
</table>
</div><div id="redux/code/redux-toolkit"><h2>Redux Toolkit</h2>

<v-pre-npm>
npm i --save <u-code-accent>react-redux</u-code-accent> <u-code-accent>@reduxjs/toolkit</u-code-accent>
</v-pre-npm>

<u-message-error>
<ul>
    <li>Не работает обновление state через присвоение нового объекта (возможно, так и нужно)</li>
    <li>Вероятно, нужно разобрать раздел из документации <a href="https://redux-toolkit.js.org/usage/immer-reducers" target="_blank" class="link">https://redux-toolkit.js.org/usage/immer-reducers</a></li>
</ul>
</u-message-error>

<v-code lang="js" title="">
import { createSlice } from "@reduxjs/toolkit";

export const counterSlice = createSlice({
  name: "counter",
  initialState: {
    value: 0
  },
  reducers: {
    changeValue1: (state) => {
      // Работает
      state.value = 1;
    },
    changeValue2: (state) => {
      // Не работает
      state = {
        value: 2
      };
    }
  }
});
</v-code>
</div><div id="redux/code/redux-saga"><h2>Redux Saga</h2>

<u-link-wrapper>
    <a href="https://redux-saga.js.org/" target="_blank">https://redux-saga.js.org/</a>
</u-link-wrapper>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Установка</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-pre-npm>
# Redux Toolkit
npm i --save <u-code-accent>react-redux</u-code-accent> <u-code-accent>@reduxjs/toolkit</u-code-accent>
# Redux Saga
npm i --save <u-code-accent>redux-saga</u-code-accent>
</v-pre-npm>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Методы</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ul class="list-point">
    <li><u-text-define>call</u-text-define> - вернет только объект описывающий эту операцию и redux-saga сможет позаботиться о вызове и возвращении результатов в функцию-генератор</li>
    <li><u-text-define>put</u-text-define> - вместо отправления действий (dispatch action) внутри функции-генератора, put возвращает объект с инструкциями для промежуточного слоя (middleware) - отправить действие</li>
</ul>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Доступ к значению Store из Saga</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->

<v-tabs :tabs="['sagas.js', 'selectors.js', 'store.js']">

<template v-slot:1>
<!------------------------------------------------------------->
<v-path>sagas.js</v-path>
<!------------------------------------------------------------->
<v-code lang="js" title="">
// Данные из Селектора
import { select } from "redux-saga/effects"

export function* setCurrentStepAsync() {
    const isTimer: boolean = yield select(getTimerSelector)
}
</v-code>
<v-code lang="js" title="">
// Данные напрямую из Store
import { store } from "./store"

export function* setCurrentStepAsync() {
    const isTimer = store.getState().playground.isTimer
}
</v-code>
</template>

<template v-slot:2>
<!------------------------------------------------------------->
<v-path>selectors.js</v-path>
<!------------------------------------------------------------->
<v-code lang="js" title="">
import { createSelector } from "reselect"

const getTimer = (state) => state.playground.isTimer
export const getTimerSelector = createSelector(getTimer, (state) => state)
</v-code>
</template>

<template v-slot:3>
<!------------------------------------------------------------->
<v-path>store.js</v-path>
<!------------------------------------------------------------->
<v-code lang="js" title="">
import { configureStore } from "@reduxjs/toolkit"

export const store = configureStore({
    reducer: {
        playground: playgroundReducer,
    },
    middleware: (getDefaultMiddleware) =>
        getDefaultMiddleware({ thunk: false }).concat(sagaMiddleware),
})
</v-code>
</template>

</v-tabs>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>redux-saga vs redux-thunk</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ul class="list-point">
    <li><em>redux-thunk</em> использует callback, поэтому возникает callback-hell</li>
    <li><em>redux-saga</em> использует генераторы, что избавляет от callback-hell</li>
</ul>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Вопросы</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->

<!------------------------------------------------------------->
<h4>Почему redux saga использует генераторы, а не асинхронные функции?</h4>
<!------------------------------------------------------------->

<h5>Ответ от ChatGPT</h5>
<ol class="list-num">
    <li><em>Управление потоком</em>: Генераторы предоставляют более гибкий и контролируемый способ управления потоком выполнения. Redux Saga позволяет паузить, возобновлять и отменять выполнение саги, что делает его мощным инструментом для сложных сценариев управления потоком данных</li>
    <li><em>Параллельное выполнение</em>: Генераторы позволяют легко создавать параллельные задачи и координировать их выполнение. Саги могут запускать несколько веток выполнения и ждать, пока все они завершатся</li>
    <li><em>Отмена задач</em>: Redux Saga обеспечивает механизм отмены выполнения саги, что может быть сложнее с асинхронными функциями. Это полезно, например, когда пользователь выполняет действие, которое требует отмены предыдущих запросов или задач</li>
</ol>
</div><div id="redux/elements/execution-order"><h2>Порядок выполнения</h2>

<v-code lang="bash" title="">
1. View       # &lt;button onClick={}&gt;Click&lt;/button&gt;
2. Dispatch   # store.dispatch(setName('Tony'))
3. Middlware  # return next(action)
4. Action     # { type: 'NAME', payload: 'Tony' }
5. Reducer    # return { ...state, name: action.payload }
6. Store
7. View
</v-code>
</div><div id="redux/elements/view"><h2>View (компонент)</h2>

<ul class="list-point">
    <li>Компонент</li>
</ul>
</div><div id="redux/elements/action"><h2>Action</h2>

<ul class="list-point">
    <li><u>Action</u> - объект с полем "type"</li>
    <li>Описывает факт, что что-то произошло, но не указывает, как состояние приложения должно измениться в ответ (<u>Reducer</u>). Изменение состоние происходит с помощью <u>Actions</u></li>
    <li><u-text-underline>ActionsCreator</u-text-underline> - функция для вызова Action</li>
    <hr>
    <li><u-code-text>type</u-code-text> - обязательное поле</li>
    <li><u-code-text>payload</u-code-text> - свойство в которое помещаются все данные, которые передаются вместе с действием</li>
</ul>

<v-code lang="js" title="">
const setName = (name) => ({
    type: NAME,
    payload: name
});
</v-code>

<!------------------------------------------------------------->
<h4>Для чего нужен Actions</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li><u>Приложение может пережить рефакторинг, но Action описывают бизнес-логику, которая не должна поменяться</u></li>
    <li>Action - объект, который описывает какое-то действие за которым скрываетмся какой-то Reducer. Реализация того что скрывается за Action это уже детали и она не принципиальна</li>
    <li>Вместо того чтобы несвязанно запускать изменения, мы пытаемся его связать с Action, который как правило никогда не будет изменяться, а за ним будет уже стоять реализация</li>
</ul>

<ul class="list-point">
    <b>Задача: Добавить пользователя</b>
    <li>- пользователь может добавиться только на фронте</li>
    <li>- пользователь может добавиться в базу данных</li>
    <li>Для Action это всё равно будет ADD_USER</li>
</ul>
</div><div id="redux/elements/middleware"><h2>Middleware</h2>

<ul class="list-point">
    <li><u-text-define>Middleware</u-text-define> - (посредник) — функция, которая вызывается при передаче действия ещё до того, как это действие попадёт в <u>reducer</u> и <u>store.</u></li>
    <li>Активировать middleware можно с помощью Redux функции applyMiddleware. Она берёт middleware, которое мы хотим зарегистрировать, и возвращает функцию, которая, в свою очередь, берёт функцию createStore. Затем эта вторая функция создаёт для нас store с уже включённым в него middleware</li>

    <hr>
    <li><u>Middleware</u> - шаблонный способ подцепления к actions, отправляемым в redux store</li>
    <li><u>Middleware</u> - функции, которые перехватывают действия</li>

    <hr>
    <li>Суть middleware функций, взять входные данные, добавить что-то и передать дальше. Middleware - это всегда функция, которые обычно возвращают функцию, если только целью middleware не является прервать цепочку вызовов</li>
    <li><u>Применение: </u>логгирование, обработка исключений, модифицирование действий, кэширование результатов и изменения способа и времени попадания действия в store</li>

    <hr>
    <li>Промежуточные слои (middlewares). Промежуточный слой это кусок кода, который выполняется после отправки действия, но перед вызовом редюсера. Промежуточные слои могут соединяться в цепочку вызовов для различной обработки действия (action), но на выходе обязательно должен быть простой объект (действие)</li>
</ul>

<hr>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Параметры</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ul class="list-point">
    <li><u-code-text>store</u-code-text> объект с методами <u>getState</u>, <u>dispatch</u> и т.д.</li>
    <li><u-code-text>next</u-code-text> функция, принимающая <u>action</u> и вызывающая <u>reducer</u></li>
    <li><u-code-text>action</u-code-text> передаваемый action c <u>type</u> и <u>payload</u></li>
</ul>

<v-code lang="js border" title="">
const starterMiddleware = store => next => action => {
    // action           => { type: "NAME", payload: "Tony" }  - Action
    // store.getState() => { reducerStarter: { name: "" } }   - Prev State

    // Вызывается Reducer
    const nextState = next(action);

    // store.getState() => { reducerStarter: { name: "Tony" } }   - New State

    return nextState;
}
</v-code>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Варианты записи</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-two-code type="js;js" comment="Стрелочная фукнкция;Обычная функция">
<template v-slot:first>
const starterMiddleware = store => next => action => {
    //
    return next(action)
}
</template>
<template v-slot:last>
const logger = (store) => {
    return function (next) {
        return function (action) {
        	//
        	return next(action)
        }
    }
}
</template>
</v-two-code>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Примеры</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->

<!------------------------------------------------------------->
<h4>Middleware Logger</h4>
<!------------------------------------------------------------->
<v-code lang="js" title="">
const logger = (store) => {
    return function (next) {
        return function (action) {
            console.log('Action', action);
            console.log('Prev State', <u-code>store.getState</u-code>());

            const nextState = <u-code>next(action)</u-code>;
            console.log('New State', <u-code>store.getState</u-code>());
            return nextState;
        }
    }
}
</v-code>

<!------------------------------------------------------------->
<h4>Middleware Forbidden Words</h4>
<!------------------------------------------------------------->
<v-code lang="js" title="">
const forbiddenWords = (store) => {
    return function (next) {
        return function (action) {
            const forbidden = ['Jack'];

            if (<u-code>action.type</u-code> === NAME) {
                const found = forbidden.filter(w => <u-code>action.payload</u-code>.includes(w))
                if (found.length) {
                    return <u-code>store.dispatch</u-code>(setName('NoName'));
                }
            }

            return <u-code>next(action)</u-code>;
        }
    }
}
</v-code>

</div><div id="redux/elements/reducer"><h2>Reducer (преобразователь)</h2>

<ul class="list-point">
    <li><u>Reducer</u> - Чистая функция типа <u-code-text>(state, action) => newState</u-code-text>, которая берет на вход <u>предыдущее состояние</u> и <u>action</u> и возвращает новое состояние. Не модифицирует данные, а всегда возвращает новые данные. Указывает, как состояние приложения должно измениться в ответ на Action</li>
    <li>Мы не мутировали наш state, мы создали новый state. В редьюсере, мы всегда должны возвращать новый объект, а не измененный предыдущий</li>
    <li>Менять состояние приложения - синхронная операция</li>
    <li>Объект, который мы возвращаем в редьюсере, далее с помощью функции <u-code-text>connect</u-code-text>, превратится в свойства для компонентов. Благодаря этому, внутри компонента <u-code-text>&lt;Component /&gt;</u-code-text>, мы сможем получить доступ к свойству <u-code-text>this.props.name_prop</u-code-text></li>
    <li><u-text-underline>Reducer Composition</u-text-underline> - фундаментальный шаблон построения redux приложений: мы разбиваем наше глобальное состояние на кусочки, за каждый кусочек отвечает свой <u-code-text>reducer</u-code-text>. Кусочки объединяются в <u-code-text>rootReducer</u-code-text> Корневом Редьюсере</li>
</ul>

<v-code lang="js" title="">
const reducerStarter = (state = { name: '' }, action) => {
    switch (action.type) {
        case 'NAME':
            return {
                ...state,
                name: action.payload
            }
        default:
            return state;
    }
};
</v-code>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Редьюсер - Чистая функция</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ul class="list-point">
    <li>Redux принимает переданное в него состояние (state) и отдаёт его каждому reducer в цикле. Если есть какие-либо изменения он ожидает получить новый объект из reducer функции (также он рассчитывает получить старый объект обратно, если изменений не было).</li>
    <li>Дальше Redux проверяет, изменилось ли старое состояние путём обычного сравнения, а так как мы мутировали свойство старого объекта вместо создания нового, внутри нашего reducer, то старое и новое состояние будут ссылаться на один и тот же объект. Поэтому Redux думает, что ничего не изменилось!</li>
</ul>

<v-code lang="js" title="">
const initState = { a: 1 };

const reducer = (state) => {
	state.a = 3;  // мутируем исходный объект initState
	return state; // возвращаем обратно initState
}

const newState = reducer(initState);
console.log(newState, initState); // {a: 3} {a: 3}
// newState === initState // true
</v-code>

<v-code lang="js" title="">
Новый объект  = Новое состояние
Старый объект = Не изменённое состояние
// Вот поэтому редюсеры должны быть "Чистыми функциями" в Redux
</v-code>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Чистые функции</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ul class="list-point">
    <li><u-text-define>Чистые функции</u-text-define> (pure functions)</li>
    <li>Возвращает один и тот же результат для одинаковых входных данных</li>
    <li>Не изменяет входные данные (иммутабельность)</li>
    <li>Не зависит от внешнего состояния (базы данных, DOM или глобальной переменной)</li>
    <li>Не имеет побочных эффектов (side effects): не влияют на состояние программы</li>
    <li>Чистые функции могут вызывать только чистые функции</li>
</ul>
</div><div id="redux/elements/store"><h2>Store</h2>

<ul class="list-point">
    <li>Store - паттерн Наблюдатель(Observer)</li>
    <li>Помещаются все данные приложения</li>
    <li>Store иммутабельный: мы можем создавать всегда только новую копию данных, а не менять старое состояние store</li>
    <li>В Redux <u>ТОЛЬКО ОДИН</u> объект Store</li>
</ul>
</div><div id="redux/methods/create-store"><h2>createStore</h2>

<div class="v-method-wrapper">
    <v-method before="" method="createStore" after="" arg="(reducer*, initialState, middleware)">
    Создание store
    </v-method>

	<v-method-arg arg="reducer">функция-обработчик изменений (редьюсер)</v-method-arg>
	<v-method-arg arg="initialState">начальное состояние</v-method-arg>
	<v-method-arg arg="middleware">берет входные данные и передает дальше</v-method-arg>
</div>

<v-code lang="js" title="">
import { createStore } from 'redux';
import rootReducer from './reducers';

export const store = <u-code>createStore</u-code>(rootReducer);
</v-code>

<u-link-wrapper>
    <a href="https://github.com/reduxjs/redux/blob/master/src/createStore.ts" target="_blank">Реализация createStore из redux</a>
</u-link-wrapper>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Упрощённая реализация</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ul class="list-point">
    <li><u-code>state</u-code> - свойство, от изменения которого зависит состояние других объектов</li>
    <li><u-code>action</u-code> - объект с полями<u>"type"</u> и <u>payload</u></li>
    <li><u-code>subscribers</u-code> - список зависящих от <u>state</u> объектов</li>
    <li><u-code-text>subscribe</u-code-text> - подписка на изменения <u>state</u></li>
    <li><u-code-text>getState</u-code-text> - геттер для получения <u>state</u></li>
    <li><u-code-text>dispatch</u-code-text> - изменение <u>state</u></li>
    <li><u-code-text>reducer</u-code-text> - функция, которая будет использоваться для изменения <u>state</u> при вызове <u>dispatch</u></li>
</ul>

<!------------------------------------------------------------->
<h4>createStore()</h4>
<!------------------------------------------------------------->
<v-code lang="js border" title="">
const createStore = (reducer, initialState) => {
    let state = <u-code>reducer</u-code>(initialState, { type: '@@redux/INIT' });
    let subscribers = [];

    return {
        <u-code-accent>subscribe</u-code-accent>(subscriber) {
            // Добавление нового подписчика в список
            subscribers.push(subscriber);
            // Возвращает функцию для удаления подписчика
            return () => {
                subscribers = subscribers.filter(el => el !== subscriber);
            };
        },
        <u-code-accent>getState</u-code-accent>() {
            return state;
        },
        <u-code-accent>dispatch</u-code-accent>(action) {
            // Передается предыдущее состояние и action. Возвращается новое состояние
            state = <u-code>reducer</u-code>(state, action);
            // Уведомление подписчиков об изменении состояния
            subscribers.forEach(el => el())
        },
    }
}
</v-code>

<!------------------------------------------------------------->
<h4>Пример использования</h4>
<!------------------------------------------------------------->
<v-code lang="js" title="">
const counterReducer = (state = 0, action) => {
    switch (action.type) {
        case 'INCREMENT': return state + 1;
        case 'DECREMENT': return state - 1;
        default: return state;
    }   
}

// Создание store
const store = <u-code>createStore</u-code>(counterReducer, 0);

// Создание подписчика
const subscriber = () => {
  console.log('Current state:', store.<u-code>getState</u-code>());
};

// Подписка на изменение состояния
const unsubscribe = store.<u-code>subscribe</u-code>(subscriber);

// Изменение state
store.<u-code>dispatch</u-code>({ type: 'INCREMENT' }); // => 1
store.<u-code>dispatch</u-code>({ type: 'DECREMENT' }); // => 0

// Удаление подписчика
unsubscribe();

// No output - подписчик уже удален
store.<u-code>dispatch</u-code>({ type: 'INCREMENT' }); 
</v-code>
</div><div id="redux/methods/apply-middleware"><h2>Middleware</h2>

<v-code lang="js" title="src/redux/store.js">
import { createStore, <u-code>applyMiddleware</u-code> } from 'redux';
import rootReducer from './reducers';
import { ping } from './enhancers/ping';

export default createStore(rootReducer, <u-code>applyMiddleware</u-code>(ping));
</v-code>

<v-code lang="js" title="src/redux/enhancers/ping.js">
export const ping = function ping(store) {
    return function (<u-code>next</u-code>) {
        return function (<u-code>action</u-code>) {
            console.log('Type: '+action.type);               // => Type: ADD_VALUE
            console.log('Payload: '+action.payload.myValue); // => Payload: New Value
            return next(action);
        };
    };
};
</v-code>

<ul class="list-point">
    <li><u-code>store</u-code> - redux-store приложения</li>
    <li><u-code>next</u-code> - функция-обертка, которая позволяет продолжить выполнение цепочки</li>
    <li><u-code>action</u-code> - действие, которое было вызвано (это store.dispatch)</li>
</ul>
</div><div id="redux/methods/combine-reducers"><h2>combineReducers</h2>

<ul class="list-point">
	<li><u-text-define>combineReducers</u-text-define> - объединение нескольких reducer</li>
</ul>

<v-code lang="js" title="">
import { <u-code>combineReducers</u-code> } from 'redux';
</v-code>
</div><div id="redux/methods/provider"><h2>Provider</h2>

<ul class="list-point">
    <li><u-text-define>Provider</u-text-define> - рутовый компонент для того чтобы прокидывать Store. Необходим для того чтобы не пробрасывать Store в каждый компонент самостоятельно. <u-code-text>Store</u-code-text> будет доступен в каждом дочернем компоненте <u-code-text>Provider</u-code-text> из функции <u-code-text>connect</u-code-text></li>
</ul>

<v-code lang="js" title="">
import { <u-code>Provider</u-code> } from 'react-redux';
</v-code>

</div><div id="redux/methods/connect"><h2>Connect</h2>

<div class="v-method-wrapper">
    <v-method before="" method="connect" after="" arg="(mapStateToProps, mapDispatchToProps)">
    Подключение компонента к Store (декоратор)
    </v-method>

	<v-method-arg arg="mapStateToProps">
		"маппинг" (соответствие) <u-text-underline>state</u-text-underline> к props. Подписаться на обновления данных
	    <ul class="list-point">
	    	<li>Не только получаем в <u-code-text>this.props.XXX</u-code-text> данные, но еще подписываемся на изменение этих данных</li>
	    	<li>Когда мы подписываемся только на нужные редьюсеры в компоненте, перерисовка происходит только в случае изменения конкретно этих данных. Если же мы бы подписались просто на весь корневой редьюсер, то не важно в каком бы редьюсере изменились данные - все подписанные на корневой редьюсер компоненты обновились бы</li>
	    </ul>
	</v-method-arg>

	<v-method-arg arg="mapDispatchToProps">"маппинг" (соответствие) <u-text-underline>dispatch</u-text-underline> к props. "Прокинуть" actions в контейнер</v-method-arg>

	<v-method-return>Результат работы функции <u>connect</u> - новый присоединенный компонент, который оборачивает переданный компонент. Компонент <u-code-text>&lt;App /&gt;</u-code-text> на выходе получился <u-code-text>&lt;Connected(App)&gt;</u-code-text>. В свойствах (<u-code-text>props</u-code-text>) компонента <u-code-text>&lt;App /&gt;</u-code-text> теперь есть метод redux <u-code-text>store - dispatch</u-code-text>, и <u>объект свойств</u></li></v-method-return>
</div>

<ul class="list-point">
    <li><u-code-text>mapStateToProps</u-code-text> срабатывает каждый раз, когда происходит изменение state</li>
</ul>

<v-code lang="js" title="Component">
import { <u-code>connect</u-code> } from 'react-redux';

const mapStateToProps = state => ({
	myValue: state.myReducer
})
const mapDispatchToProps = {
	getMethod: getMethod
}
export default connect(
	mapStateToProps,
	mapDispatchToProps
)(Component);
</v-code>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>mapDispatchToProps</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-two-code type="js;js" comment="Объект;Функция">
<template v-slot:first>
const mapDispatchToProps = {
	getPhotosAction: return
}
</template>
<template v-slot:last>
const mapDispatchToProps = function(<u-code>dispatch</u-code>) {
	return {
		getPhotosAction: function(year) {
			return <u-code>dispatch</u-code>(getPhotos(year));
		}
	}
}
</template>
</v-two-code>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Варианты</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-two><template v-slot:first>
<v-code lang="js" title="">
export default connect(
	null,              // subscribe = false
	null               // action = false
)(Component);
</v-code>
<v-code lang="js" title="">
export default connect(
	mapStateToProps,   // subscribe = true
	null               // action = false
)(Component)
</v-code>
</template><template v-slot:last>
<v-code lang="js" title="">
export default connect(
	null,              // subscribe = false
	mapDispatchToProps // action = true
)(Component)
</v-code>
<v-code lang="js" title="">
export default connect(
	mapStateToProps,   // subscribe = true
	mapDispatchToProps // action = true
)(Component)
</v-code>
</template></v-two>
</div><div id="redux/methods/hooks"><h2>useDispatch, useSelector</h2>

<v-code lang="js" title="">
import React from 'react';
import { <u-code>useDispatch</u-code>, <u-code>useSelector</u-code> } from 'react-redux';
import { setName } from '../../redux/actions';

const App = () =&gt; {
    const <u-code>dispatch</u-code> = useDispatch();
    const <u-code>name</u-code> = useSelector(state =&gt; state.reducerStarter.name);

	return (
		&lt;&gt;
            &lt;h1&gt;{name}&lt;/h1&gt;
			&lt;button onClick={() =&gt; dispatch(setName('Jack'))}&gt;
				Name Jack
			&lt;/button&gt;
		&lt;/&gt;
	);
}

export default App;
</v-code>
</div><div id="redux/redux/info-flux"><h2>Flux</h2>

<ul class="list-point">
    <li><u-text-define>Flux-архитектура</u-text-define> - архитектурный подход или набор шаблонов программирования для построения пользовательского интерфейса веб-приложений, сочетающийся с реактивным программированием и построенный на однонаправленных потоках данных</li>
    <li><b>Может быть несколько STORE</b></li>
</ul>

<ol class="list-num">
	<b>Методология Flux состоит из 4 частей</b>
	<li><u>View</u> (компоненты)</li>
	<li><u>Action</u> (события)</li>
	<li><u>Dispatcher</u> - сообщает Store о каком-то событии и передает информацию</li>
	<li><u>Store</u> (хранилище) - задача ограничить доступ к состоянию через определенный интерфейс</li>
</ol>

<p>
	<u-code-text>View</u-code-text> -> 
	<u-code-text>Action</u-code-text> -> 
	<u-code-text>Dispatcher</u-code-text> -> 
	<u-code-text>Store</u-code-text> -> 
	<u-code-text>View</u-code-text>
</p>

<hr>
<ul class="list-point">
	<li><b>Достоинства: </b>сложно случайно измененить состояние. Если что-то произойдет, то ясно где искать ошибку</li>
</ul>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Flux vs MVC</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-two><template v-slot:first>
<img src="/@img/redux/srtucture-flux.png" width="450px">
</template><template v-slot:last>
<img src="/@img/redux/srtucture-mvc.png" width="450px">
</template></v-two>




</div><div id="redux/redux/info-redux"><h2>Информация</h2>

<u-link-wrapper>
    <a href="https://react-redux.js.org/introduction/quick-start" target="_blank">Документация react-redux</a>
    <a href="https://redux.js.org/introduction/getting-started" target="_blank">Документация redux</a>
    <a href="https://max-frontend.gitbook.io/redux-course-ru-v2/" target="_blank">MaxFrontend Book (книга)</a>
    <a href="https://getinstance.info/articles/react/learning-react-redux/" target="_blank">Новый уровень React: Redux</a>
    <a href="https://habr.com/ru/company/ruvds/blog/447134/" target="_blank">Учебный курс по React</a>
</u-link-wrapper>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>NPM</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-pre-npm>
npm i --save <u-code-accent>redux</u-code-accent>
npm i --save <u-code-accent>react-redux</u-code-accent>
</v-pre-npm>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Redux</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ul class="list-point">
    <li><u-text-define>Redux</u-text-define> - это инструмент управления состоянием приложения (предсказуемый контейнер состояния для JS приложений). Он подходит для одностраничных приложений, в которых управление состоянием может со временем становиться сложным. Redux не связан с каким-то определенным фреймворком, и хотя разрабатывался для React, может использоваться с Angular или jQuery</li>

    <li>Redux - <u>отделение данных от представления</u></li>

    <li>В React «однонаправленный поток данных» - поток данных проходит в одном направлении, от родителя к ребенку. При этом не очевидно, как два компонента, не связанные отношением родитель-ребенок, будут взаимодействовать между собой</li>

    <li>Redux предлагает хранить все состояние приложения в одном месте, называемом <u>«store»</u> («хранилище»). Компоненты «отправляют» изменение состояния в хранилище, а не напрямую другим компонентам. Компоненты, которые должны быть в курсе этих изменений, «подписываются» на хранилище</li>
</ul>

<!------------------------------------------------------------->
<h4>Принципы</h4>
<!------------------------------------------------------------->
<ol class="list-num">
    <li>Единственный источник истины</li>
    <li>Состояние доступно только для чтения</li>
    <li>Изменения делаются «чистыми» функциями</li>
</ol>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Однонаправленный поток данных</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ol class="list-num">
    <li>Приложение получило начальное состояние (<u-code-text>initial state</u-code-text>)</li>
    <li>Пользователь нажав кнопку, отправил действие (<u-code-text>dispatch action</u-code-text>)</li>
    <li>Соответсвующий редьюсер обновил часть приложения, в согласии с тем, что узнал от действия</li>
    <li>Приложение изменилось и теперь отражает новое состояние</li>
    <li>... (все повторяется по кругу, с пункта 2)</li>
</ol>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Структура файлов</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ul class="list-point">
    <li>Rails Style</li>
    <li>Redux Ducks</li>
</ul>
</div><div id="redux/redux/functional-programming"><h2>Принципы функционального программирования в Redux</h2>

<ul class="list-point">
	<li><u>Чистые функции (pure functions)</u> - функция возвращаюшая знечение, зависомое только от получаемых аргументов</li>
	<li><u>Неизменность данных (immutability)</u></li>
</ul>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Иммутабельность</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ul class="list-point">
    <li><b>Два подхода к изменению данных:</b></li>
    <ol class="list-num">
        <li><u-text-underline>Мутировать (изменять)</u-text-underline> данные, напрямую устанавливая новые значения</li>
        <li><u-text-underline>Иммутабельность</u-text-underline> заменять данные новой копией, которая содержит изменения</li>
    </ol>

    <li><b>Преимущества:</b></li>
    <ol class="list-num">
        <li>Перерендеринг. Помогает создавать в React чистые компоненты. Неизменяемые данные позволяют определить наличие изменений и момент, когда компонент нужно перерендерить</li>
        <li>«Путешествие во времени». Позволяет сохранять предыдущее состояние без изменений и обращаться к ним позже</li>
        <li>Обнаружение изменений. Если неизменяемый объект, на который ссылается, отличается от предыдущего, то объект изменился</li>
    </ol>
</ul>
</div><div id="redux/plugins/redux-toolkit"><h2>@reduxjs/toolkit</h2>

<u-link-wrapper>
	<a href="https://redux-toolkit.js.org/" target="_blank">Документация</a>
	<a href="https://github.com/reduxjs/redux-toolkit" target="_blank">GitHub</a>
</u-link-wrapper>
</div><div id="redux/plugins/redux-devtools-extension"><h2>redux-devtools-extension</h2>

<u-link-wrapper>
	<a href="https://github.com/zalmoxisus/redux-devtools-extension" target="_blank">redux-devtools-extension</a>
	<a href="https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd?hl=ru" target="_blank">Интернет-магазин Chrome</a>
</u-link-wrapper>

<v-pre-npm>
npm i --save <u-code-accent>redux-devtools-extension</u-code-accent> # для работы devtools
</v-pre-npm>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Использование</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->

<!------------------------------------------------------------->
<h4>Минимальный вариант</h4>
<!------------------------------------------------------------->
<v-code lang="js" title="redux/reducers/store.js">
import { createStore } from 'redux';
import { <u-code>composeWithDevTools</u-code> } from 'redux-devtools-extension';
import rootReducer from './reducers';

export default createStore(
	rootReducer,
	<u-code>composeWithDevTools</u-code>()
);
</v-code>

<!------------------------------------------------------------->
<h4>Вместе с "redux-thunk"</h4>
<!------------------------------------------------------------->
<v-code lang="js" title="">
import { createStore, applyMiddleware } from 'redux';
import { <u-code>composeWithDevTools</u-code> } from 'redux-devtools-extension';
import thunk from 'redux-thunk';
import rootReducer from './reducers';

export default createStore(
	rootReducer,
	<u-code>composeWithDevTools</u-code>(
		applyMiddleware(thunk)
	)
);
</v-code>

<!------------------------------------------------------------->
<h4>Без "redux-devtools-extension", вместе с "compose"</h4>
<!------------------------------------------------------------->
<v-code lang="js" title="">
import { <u-code>compose</u-code>, createStore, applyMiddleware } from 'redux';
import thunk from 'redux-thunk';
import rootReducer from './reducers'

const store = createStore(
    rootReducer,
    compose(
        applyMiddleware(thunk),
        window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()
    )
);
</v-code>

<!------------------------------------------------------------->
<h4>Без "redux-devtools-extension"</h4>
<!------------------------------------------------------------->
<ul class="list-point">
    <li>Если найдено расширение, то мы применяем его во второй аргумент <u-code-text>createStore</u-code-text>, в другом случае он будет <u-code-text>undefined</u-code-text></li>
</ul>

<v-code lang="js" title="">
import { createStore } from 'redux';
import rootReducer from './reducers'

// Вынести в переменную
const ext = window.__REDUX_DEVTOOLS_EXTENSION__;
const devtoolMiddleware = ext && ext();

export default createStore(rootReducer, devtoolMiddleware);
</v-code>
</div><div id="redux/plugins/redux-thunk"><h2>redux-thunk</h2>

<ul class="list-point">
    <li>Добавление асинхронного кода в actions</li>
    <li>Если action creator возвращает функцию - она выполняется. Если возвращает простой объект - передается дальше</li>
    <li>В цепочке middleware есть доступный метод dispatch и getState</li>
    <hr>
    <li>redux-thunk позволяет генератору действия (action creator) отправлять функцию в дополнении к объекту, конвертируя таким образом генератор действия в преобразователь.
    </li>
</ul>

<v-pre-npm>
npm i --save <u-code-accent>redux-thunk</u-code-accent>
</v-pre-npm>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Использование</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-code lang="js" title="redux/reducers/store.js">
import { createStore, applyMiddleware } from 'redux';
import thunk from '<u-code>redux-thunk</u-code>';
import rootReducer from './reducers';

export default createStore(
    rootReducer,
    applyMiddleware(<u-code>thunk</u-code>)
);
</v-code>

<v-code lang="js" title="redux/actions.js">
import axios from 'axios';
import { ASYNC_PENDING, GET_REQUEST_TIMEOUT } from './actionTypes';

// может быть несколько dispatch
export const getAsyncData = () => dispatch => {
    
    // синхронное действие
    <u-code>dispatch</u-code>({
        type: ASYNC_PENDING
    })

    // асинхронный запрос на сервер
    axios.get('https://yandex.ru/')
        .then(response => {
            <u-code>dispatch</u-code>({
                type: ASYNC_SUCCESS,
                payload: response.data,
            })
        })
        .catch(error => console.log(error));

    // асинхронный setTimeout
    setTimeout(() => {
        <u-code>dispatch</u-code>({
            type: GET_REQUEST_TIMEOUT,
            payload: [1, 2, 3, 4, 5],
        })
    }, 5000)
};
</v-code>

<!------------------------------------------------------------->
<h4>Асинхронная функция</h4>
<!------------------------------------------------------------->
<v-code lang="js" title="">
export const getAsyncData = () => {
    return async dispatch => {
        const response = await fetch('')
        const json = await response.json()
        dispatch({
            type: 'ASYNC_SUCCESS',
            payload: json
        })
    }
}
</v-code>


<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Варианты написания</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-two-code type="js;js" comment="Стрелочная функция;Обычная функция">
<template v-slot:first>
const getAsyncData = () => (dispatch) => {
    //
};
</template>
<template v-slot:last>
const getAsyncData = function() {
    return function(dispatch) {
        //
    }
}
</template>
</v-two-code>
</div><div id="redux/plugins/redux-saga"><h2>redux-saga</h2>

<ul class="list-point">
	<li>Работа с side-effects</li>
</ul>

<v-pre-npm>
npm i --save <u-code-accent>redux-saga</u-code-accent>
</v-pre-npm>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Почему используются генераторы, а не async await</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ul class="list-point">
	<a href="https://github.com/redux-saga/redux-saga/issues/987#issuecomment-301039792" target="_blank" class="link">Ссылка на issue</a>
	<li>redux-saga нельзя переписать на async / await - в нем используются обещания и сложнее координировать с ними «параллельные» задачи. Это также означало бы большие изменения в семантике, в том, как все работает на самом деле. В примере эффект выбора синхронный - этого нельзя добиться с помощью обещаний.</li>
	<li>Сага, являясь интерпретатором эффектов, дает нам полный контроль над тем, как и когда эти эффекты разрешаются + эффекты - это просто простой объект, который легко сопоставить и можно отслеживать, что также намного сложнее с Promises.</li>
</ul>
</div><div id="redux/plugins/redux-form"><h2>redux-form</h2>

<v-pre-npm>
npm i --save <u-code-accent>redux-form</u-code-accent>
</v-pre-npm>
</div><div id="redux/plugins/redux-actions"><h2>redux-actions</h2>

<v-pre-npm>
npm i --save <u-code-accent>redux-actions</u-code-accent>
</v-pre-npm>
</div><div id="redux/plugins/redux-logger"><h2>redux-logger</h2>

<v-pre-npm>
npm i --save-dev <u-code-accent>redux-logger</u-code-accent>
</v-pre-npm>

<v-code lang="js" title="src/redux/store.js">
import { createStore, applyMiddleware } from 'redux';
import rootReducer from './reducers';
import <u-code>logger</u-code> from 'redux-logger';

export default createStore(
	rootReducer,
	applyMiddleware(<u-code>logger</u-code>)
);
</v-code>
</div><div id="redux/other/constants-name"><h2>Название констант</h2>

<v-code lang="js" title="">
BOOK_ADDED_TO_CART
BOOK_REMOVED_FROM_CART

FETCH_BOOKS_REQUEST
FETCH_BOOKS_SUCCESS
FETCH_BOOKS_FAILURE

LOGIN_REQUEST
LOGIN_SUCCESS
LOGIN_FAILURE
</v-code>
</div></div>
                </div>
            </div>

            <!-- CSS -->
            <link rel="stylesheet" type="text/css" href="../src/css/starter.css">
            <link rel="stylesheet" type="text/css" href="../src/css/custom.css">
            <link rel="stylesheet" type="text/css" href="../src/css/layout.css">

            <!-- Libraries -->
            <script src="../src/libs/highlight/highlight.pack.js"></script>
            <script src="../src/libs/vue.js"></script>

            <!-- Custom Elements -->
            <script src="../src/components-web/custom-elements.js"></script>
            <link rel="stylesheet" type="text/css" href="../src/components-web/custom-elements.css">

            <!-- Vue.js Components -->
            <script src="../src/components-vue/vue-components.js"></script>
            <link rel="stylesheet" type="text/css" href="../src/components-vue/vue-components.css">

            <!-- JavaScript -->
            <script src="../src/js/init.js"></script>
            <script src="../@modules/@links.js"></script>
            <script src="../src/vue.js/build.js"></script>
        </body>
    </html>
