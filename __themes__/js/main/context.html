<h2>Контекст: this, call, apply, bind</h2>

<ul class="list-point">
	<li><u-text-define>Контекст</u-text-define> - объект, который получит функция на момент выполнения своего кода</li>
</ul>

<v-code lang="js" title="">
function foo() { console.log(this); }

// Глобальный контекст
foo();
// => window || undefined

// Контекст объекта
const obj = { name: 'Tony' }
foo.call(obj);
// => { name: 'Tony' }
</v-code>


<hr>


<ul class="list-point">
	<li><u-text-define>Контекст выполнения (Execution Context)</u-text-define> - служебная информация, которая соответствует текущему запуску функции. Она включает в себя локальные переменные функции и конкретное место в коде, на котором находится интерпретатор. У каждого вызова функции свой «контекст выполнения» и он всегда разный в зависимости от того как функция была вызвана</li>
	<li>Контекст бывает либо глобальным, с которого начинается исполнения скрипта, либо контекстом выполнения вызова, который начинается с момента входа в тело функции</li>
	<li>В каждый момент времени активен только один контекст выполнения. Именно поэтому Javascript называют “однопоточным”, имея ввиду, что только одна инструкция исполняется в один момент времени. Типичный браузер отслеживает контексты выполнения с помощью стека</li>
	<li><u-text-define>Контекст вызова функции</u-text-define> - тот объект который ее вызывает</li>
</ul>

<p><img src="/__img__/js/context/execution-context.png" width="400px"></p>

<ul class="list-point">
	<li><u-text-define>this</u-text-define> - ссылка на текущий контекст вызова (на текущий объект с которым произошло событие). Определяется в момент вызова функции</li>
	<li><u>this</u> - обращение к контексту функции. Функция вызывается в контексте объекта, this ссылка на этот объекта</li>
	<li><u>this</u> зависит от того как вызвана функция</li>
	<li>Любая функция может иметь в себе <u>this</u>. Если функция использует <u>this</u> - это подразумевает работу с объектом</li>
	<li><u>this</u> - это текущий объект при вызове «через точку» и новый объект при конструировании через <u>new</u></li>
	<li><u>Функции</u> не привязаны к своему контексту <u>this</u></li>
</ul>

<ul class="list-point">
    <b>На что указывает <u>this</u></b>
    <li>В глобальном контексте - на глобальный объект</li>
    <li>В функциональном контексте - на контекст, откуда функция вызвана</li>
    <li>В функции, обрабатывающей событие DOM - на DOM элемент, который вызвал событие</li>
</ul>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>Значение this устанавливается в зависимости от того, как вызвана функция</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<v-two><template v-slot:first>

<!------------------------------------------------------------->
<h4>1. При вызове функции как метода</h4>
<!------------------------------------------------------------->
<u-code-text>this = obj</u-code-text>
<v-code lang="js" title="">
obj.func(...)
obj["func"](...)
</v-code>

<!------------------------------------------------------------->
<h4>2. При обычном вызове</h4>
<!------------------------------------------------------------->
<u-code-text>this = window (ES3) /undefined (ES5)</u-code-text>
<v-code lang="js" title="">
func(...)
</v-code>

</template><template v-slot:last>

<!------------------------------------------------------------->
<h4>3. В new</h4>
<!------------------------------------------------------------->
<u-code-text>this = {} (новый объект)</u-code-text>
<v-code lang="js" title="">
new func()
</v-code>

<!------------------------------------------------------------->
<h4>4. Явное указание</h4>
<!------------------------------------------------------------->
<u-code-text>this = context (явная передача)</u-code-text>
<v-code lang="js" title="">
func.apply(context, args)
func.call(context, arg1, arg2, ...)
</v-code>

</template></v-two>

<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<h3>4 способа вызова this</h3>
<!-- xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx -->
<ol class="list-num">
    <li>bind call apply</li>
    <li>new конструктор</li>
    <li>функция</li>
    <li>объект</li>
</ol>
